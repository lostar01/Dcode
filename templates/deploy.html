{% extends 'layout.html' %}
{% block title %}{{ title }} {% endblock %}

{% block content %}
<div class="container">
    <h1>channels 发布</h1>
    <input type="button" class="btn btn-primary" value="初始化图表" onclick="initDiagram()"/>
    <input type="button" class="btn btn-primary" value="代码发布"/>
    <table class="table table-bordered" style="margin-top: 5px;">
        <tr>
            <td>项目名称: {{task_obj.project.title}}</td>
            <td>环境: {{task_obj.project.get_env_display}}</td>
        </tr>
        <tr>
            <td>版本: {{task_obj.tag}}</td>
            <td>发布状态: {{task_obj.get_status_display}}</td>
        </tr>
        <tr>
            <td colspan="2">仓库地址: {{task_obj.project.repo}}</td>
        </tr>
        <tr>
            <td colspan="2">线上路径: {{task_obj.project.path}}</td>
        </tr>
        <tr>
            <td colspan="2">关联服务器:
                <ul>
                {% for server_obj in task_obj.project.server.all %}
<!--                <span style="border: 1px solid #ddd; padding: 5px;">{{ server_obj.hostname }}</span>-->
                    <li>{{ server_obj.hostname }}</li>
                {% endfor %}
                    </ul>
            </td>
        </tr>


    </table>
    <div id="content" style="height: 350px; background-color: #DAE4E4">


    </div>
</div>
{% endblock %}

{% block js %}
    <script>
        function initDiagram(){
            var $ = go.GraphObject.make;
        var diagram = $(go.Diagram, "content",{
            layout: $(go.TreeLayout,{
                angle: 0,
                nodeSpacin: 20,
                layperSpacin: 70

            })
        });

<!--        diagram.nodeTemplate = $(go.Node, "Auto",-->
<!--        $(go.Shape,{-->
<!--            figure: "RoundedRectangle",-->
<!--            fill: "lightgray",-->
<!--            stroke: "lightgray"-->
<!--        },new go.Binding("figure","figure"),new go.Binding("fill","color"),new -->
<!--        )-->
        }

    </script>
{% endblock %}